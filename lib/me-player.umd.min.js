var e,t;e=this,t=function(e){"use strict";function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e=e&&e.hasOwnProperty("default")?e.default:e;var i=Object.assign,r=function(e){return null==e||""===e};return function(){function a(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),void 0===(this instanceof a?this.constructor:void 0)||(this instanceof a?this.constructor:void 0)!==a)throw new Error("MePlayer \u5fc5\u987b\u5b9e\u4f8b\u5316\u3002");this.config=i({autoplay:!1,step:5,allowSetSpeed:[.5,1,1.25,1.5,2],setSpeed:1,ready:!1,duration:0,currentTime:0,state:0,skinLayout:!1},o),this.instanceMap={},this.availableMap={},this.leader=null,this.eventList={},this.interval=null;for(var l=[],s=function(e){var a=n[e];if(r(a.source))throw new Error("\u64ad\u653e\u5668\u3010 source \u3011\u672a\u6307\u5b9a\u3002");if(r(a.id))throw new Error("\u64ad\u653e\u5668\u3010 id \u3011\u672a\u6307\u5b9a\u3002");if(l.find(function(e){return e===a.id}))throw new Error("\u64ad\u53d1\u5668\u3010 id \u3011 \u4e0d\u80fd\u91cd\u590d\u3002");l.push(a.id),n[e]=i({id:"",source:"",width:"100%",height:"100%",autoplay:!1,isLive:!1,rePlay:!1,playsinline:!0,preload:!0,controlBarVisibility:"always",waitingTimeout:30,useH5Prism:!0},{skinLayout:t.config.skinLayout},a)},u=0;u<n.length;u++)s(u);var c=0,f=function(){++c<n.length||t.leader.duration<=0||(t.config.ready=!0,t.emit("ready",t.config),t.emit("init",t.config),t.emit("state",t.config),t.config.autoplay&&(t.play(),t.emit("play",t.config)))},d=!0,h=!1,v=void 0;try{for(var y,p=function(){var i=y.value,r=i.id,a={player:null,state:0,duration:0,currentTime:0};a.player=new e(i),a.player.on("ready",function(e){a.state=1;var i=a.player.getDuration();a.duration=/\d/.test(i)?i:0,a.duration>0&&(t.availableMap["player:".concat(r)]=a),a.duration>t.config.duration&&(t.config.duration=i,t.leader=a),f()}),a.player.on("error",function(e){console.error("".concat(r," \u9519\u8bef"),e),a.state=2;e.paramData.error_code;f()}),t.instanceMap["player:".concat(r)]=a},g=n[Symbol.iterator]();!(d=(y=g.next()).done);d=!0)p()}catch(e){h=!0,v=e}finally{try{d||null==g.return||g.return()}finally{if(h)throw v}}this.list=n}var n,o,l;return n=a,(o=[{key:"on",value:function(e,t){void 0!==t&&t instanceof Function&&(this.eventList[e]||(this.eventList[e]=[]),this.eventList[e].push(t))}},{key:"emit",value:function(e,t){var i=this.eventList[e];if(i&&!(i.length<=0)){var r=!0,a=!1,n=void 0;try{for(var o,l=i[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){(0,o.value)(t)}}catch(e){a=!0,n=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw n}}}}},{key:"isReady",value:function(){return this.config.ready&&null!==this.leader}},{key:"monitor",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(clearTimeout(this.interval),t){!function t(){var i=e.config;i.currentTime===i.duration&&clearTimeout(e.interval);var r=e.leader.duration,a=e.leader.player.getCurrentTime(),n=a-1.5<=0?0:a-1.5,o=a+1.5>=r?r:a+1.5;e.config.currentTime=a;for(var l=0,s=Object.values(e.availableMap);l<s.length;l++){var u=s[l];if(e.leader!==u){var c=u.player,f=u.duration,d=u.currentTime;if(a>=f)d<f&&(u.currentTime=f,c.seek(f+1));else{var h=c.getCurrentTime();h>=n&&h<=o?u.currentTime=h:(u.currentTime=a>=f?f:a,c.play(),c.seek(u.currentTime))}}}e.emit("monitor",e.config),a>=r?(clearTimeout(e.interval),e.config.state=3,e.emit("complete",e.config),e.emit("state",e.config)):setTimeout(t,500)}()}}},{key:"play",value:function(){if(this.isReady()&&1!==this.config.state){for(var e=this.config.setSpeed,t=this.leader.player.getCurrentTime(),i=0,r=Object.values(this.availableMap);i<r.length;i++){var a=r[i];if(this.leader!==a){var n=a.player,o=a.duration;n.setSpeed(e),t>=o?(n.seek(o+1),a.currentTime=o):(n.play(),n.seek(t))}}this.leader.player.setSpeed(e),this.leader.player.play(),this.monitor(!0),this.config.state=1,this.emit("state",this.config)}}},{key:"pause",value:function(){if(this.isReady()&&2!==this.config.state){this.monitor(!1);for(var e=0,t=Object.values(this.availableMap);e<t.length;e++){t[e].player.pause()}this.config.state=2,this.emit("state",this.config)}}},{key:"seek",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.isReady()){for(var t=0,i=Object.values(this.availableMap);t<i.length;t++){var r=i[t],a=r.player,n=r.duration;e>=n?(a.seek(n+1),r.currentTime=n):(1===this.config.state&&a.play(),a.seek(e))}this.config.currentTime=e,this.emit("monitor",this.config)}}},{key:"prev",value:function(){this.prevAndForward(!1)}},{key:"forward",value:function(){this.prevAndForward(!0)}},{key:"prevAndForward",value:function(e){if(this.isReady()){var t=this.leader.duration,i=this.config.step,r=this.leader.player.getCurrentTime(),a=e?r+i>=t?t:r+i:r-i<=0?0:r-i;this.seek(a)}}},{key:"setSpeed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.isReady()){e=this.config.allowSetSpeed.find(function(t){return t==e})?e:1,this.config.setSpeed=e;for(var t=0,i=Object.values(this.availableMap);t<i.length;t++){i[t].player.setSpeed(e)}}}},{key:"dispose",value:function(){this.config.ready=!1,clearTimeout(this.interval);for(var e=0,t=Object.values(this.instanceMap);e<t.length;e++){t[e].player.dispose()}}}])&&t(n.prototype,o),l&&t(n,l),a}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("Aliplayer")):"function"==typeof define&&define.amd?define(["Aliplayer"],t):(e=e||self).XxmiUtil=t(e.Aliplayer);